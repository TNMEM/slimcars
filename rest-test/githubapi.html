<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Github Watching - No CORS</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.min.css">
  
  <style>
  .scroll {
      width: 100%;
      height: 100vh;
      overflow: scroll;
  }
  </style>
  
</head>
<body>
  <div class="container">
    <div class="row main">

      <div class="five columns scroll">
        <h5>Github Subscription List</h5>
        <ul id="git-list"></ul>
      </div>

      <div class="seven columns">
        <h5>Description:</h5>
        <span id="git-description"></span>
      </div>

    </div>
  </div>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/tinysort/2.2.2/tinysort.min.js"></script>
  <script>
    $(document).ready(function() {
      // jQuery...
      
      var rootAPI = "//api.github.com/users/tnmem/subscriptions";
      var subs; // the subscriptions/watching repositories...
      
      findAll();
      
      // Retrive show details when list item is clicked
	    $(document).on('click', 'ul#git-list li a', function(e) {
	    	e.preventDefault();
	    	var anID = $(this).data('id');
	    	$.map(subs, function(git) {
          if (git.id == anID) {
            console.log("Found: ", anID, git.id);
    			  $('#git-description').html('Click to Go To: <a href="' + git.html_url + '" target="_blank">' + git.full_name + '</a><br>' + git.description);
          }
        });
	    });

      // Get all using PHP on same server to defeat CORS problem...
  	  function findAll() {
    		$.ajax({
    			type: 'GET',
    			url: rootAPI,
    			dataType: 'json',
    			success: function(response){
    			  subs = response;
    				console.log('Success: ', subs);
    				renderList(subs);
    			},
    			error: function(xhr, type){
    			   console.log(xhr, type);
    			}
  		  });
	    }
	    
      // Render list
    	function renderList(data) {
    		$('#git-list li').remove();
    		$('#git-description').html('');
    		$.each(data, function(i, git) {
    			$('#git-list').append('<li>Latest Change: <a href="#" data-id="' + git.id + '">' + git.pushed_at + '<br>' + git.full_name + '</a></li>');
    		});
    		tinysort('#git-list>li',{order:'desc'});
    	}

    });
  </script>
</body>
</html>
